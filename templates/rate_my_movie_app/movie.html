{% extends "rate_my_movie_app/base.html" %}

{% block title_block %}
  Movie
{% endblock %}

{% block body_block %}
  {% if movie %}
  <div class="content-slice">
    <h1>{{ movie.title }}({{ movie.release_date.year }})</h1>
    <div>
      <h2> Movie Info </h2>
      <img src="/media/{{ movie.thumbnail }}"
           alt="This movie doesn't have a thumbnail"/>
      <p>genres: {{ movie.get_genres }}</p>
      <p>views: {{ movie.views }} </p>
      <p>rating: {{ movie.get_average_rating }}</p>
      <p>{{ movie.description }}</p>
    </div>
    <div>
        <h2>Comments</h2>
    {% if comments %}
        {% for comment in comments %}
        <div style="padding-left:{{ comment.as_padding }}px;">
            <p> {{ comment.author }}@{{ comment.time_stamp }} said:
                <br/>
                {{ comment.body }}
                <br/>
				{% if user.is_authenticated %}
					<button class="create-modal-comment btn btn-primary"
							type="button" 
							name="button"
							data-id="/rate_my_movie_app/create_modal_comment/{{ user.pk }}-{{ comment.pk }}-{{ movie.pk }}/">
					  Reply
					</button>
				{% endif %}
            </p>
          </div>
        {% endfor %}    
      {% endif %}
      {% if form %}
        <div>
          <form id="comment_id"
                method="post"
                action="/rate_my_movie_app/movie/{{ movie.slug }}/">
            {% csrf_token %}
            {% for hidden in form.hidden_fields %}
              {{ hidden }}
            {% endfor %}
            {% for field in form.visible_fields %}
              <div>
                {{ field.errors }}
                {{ field.help_text }}
                {{ field }}
              </div>
            {% endfor %}
            <input type="submit"
                   name="submit"
                   value="post"/>
          </form>
        </div>
        {% endif %}
    </div> 
	</div>
  {% else %}
    The specified movie has not been uploaded.
  {% endif %}

 <div class="modal fade" tabindex="-1" role="dialog" id="modal">
   <div class="modal-dialog" role="document">
     <div class="modal-content">
     </div>
   </div>
 </div>

 <script type="text/javascript">
  $(document).ready(function(){
    $(".create-modal-comment").each(function(){
        $(this).modalForm({formURL: $(this).data('id')});
    });
  });
 </script>
{% endblock %}
